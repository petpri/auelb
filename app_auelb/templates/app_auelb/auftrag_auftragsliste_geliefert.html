{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load django_bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}

{% block header %}
<nav class="navbar navbar-expand-sm bg-dark navbar-dark fixed-top w-100">
    <div class="container-fluid px-2 d-flex align-items-center">
        <form method="get" class="d-flex w-100 align-items-center">
            <input name="searchsuche" class="form-control me-2" type="search" placeholder="Kundenauf. enthält" style="width: 180px;">
            <input name="materialsuche" class="form-control me-2" type="search" placeholder="Materialnr. enthält" style="width: 150px;">
            <input name="kundennummer" class="form-control me-2" type="search" placeholder="Kundennr. enthält" style="width: 180px;">
            <input name="fertigungsauftrag" class="form-control me-2" type="search" placeholder="Fertigungsauf. enthält" style="width: 170px;">
            <!--<input name="status" class="form-control me-2" type="search" placeholder="Status enthält" style="width: 120px;">-->
            <select class="form-select me-2" name="my_select" style="width: 150px;">
                {% for item in data %}
                    <option value="{{ item.id }}">{{ item.kd_auswahl }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="btn btn-outline-success btn-sm me-2">Search</button>
            <a href="{% url 'kd_auftragsliste' %}" class="btn btn-outline-success btn-sm me-2">Kundenaufträge</a>
            <a href="{% url 'auftragsliste_nicht_geliefert' %}" class="btn btn-outline-success btn-sm me-2">PRODUKTIV</a>


            
        </form>
        <div class="text-danger" style="font-weight: normal;">
            {{ mode_label }}
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="table-responsive px-2">
    <table class="table table-bordered table-sm align-middle text-nowrap fs-7 m-0 w-100 m-0">
        <thead class="thead-dark sticky-top">
            <tr class="table-danger">
                <th>M</th>
                <th>U</th>
                <th>KD-Auftrag</th>
                <th>KD-Nummer</th>
                <th>FERT/BANF</th>
                <th>Material</th>
                <th>Bez./KD-Name</th>
                <th>FREI</th>
                <th>bestellt</th>
                <th>Endtermin</th>
                <th>STATUS</th>
            </tr>
        </thead>
        <tbody>
            {% for z in ihre_daten.all %}
            <tr class="table-primary py-1">
                <td></td>
                <td>{{ z.id }}</td>
                <td>{{ z.kundenauftrag|default:"" }}</td>
                <td>{{ z.kundenname.kundennummer|default:"" }}</td>
                <td></td>
                <td></td>
                <td>{{ z.kundenname.kundenname|default:"" }}</td>
                <td></td>
                <td></td>
                <td>{{ z.v_endtermin|date:"d.m.Y" }}</td>
                <td>{{ z.statuskundenauftrag }}</td>
            </tr>

            {% for y in z.order_back_1.all %}
    {% if y.bezeichnung.materialnummer %}
    <tr class="table-success">
        {% if y.bezeichnung.merkmale %}
            <td>
                <a href="{% url 'merkmale_bearbeiten' y.bezeichnung.merkmale.pk %}?from=geliefert">M</a>
            </td>
        {% else %}
            <td></td>
        {% endif %}
        {% if y.bezeichnung.urblatt %}
            <td>
                <a href="{% url 'urblatt_bearbeiten' y.bezeichnung.urblatt.pk %}?from=geliefert">U</a>
            </td>
        {% else %}
            <td></td>
        {% endif %}
        <td></td>
        <td></td>
        <td>{{ y.p_fertigungsauftrag|default:"" }}</td>
        <td>{{ y.bezeichnung.materialnummer|default:"" }}</td>
        <td>{{ y.bezeichnung.bezeichnung|default:"" }}</td>
        <td></td>
        <td>{{ y.p_auftragsmenge }}</td>
        <td>{{ y.p_endtermin|date:"d.m.Y" }}</td>
        <td>{{ y.statusprodukt }}</td>
    </tr>

    {% for x in y.order_back_2.all %}
        {% if x.bezeichnung.materialnummer %}
        <tr class="table-warning">
            {% if x.bezeichnung.merkmale %}
                <td>
                    <a href="{% url 'merkmale_bearbeiten' x.bezeichnung.merkmale.pk %}?from=geliefert">M</a>
                </td>
            {% else %}
                <td></td>
            {% endif %}
            {% if x.bezeichnung.urblatt %}
                <td>
                    <a href="{% url 'urblatt_bearbeiten' x.bezeichnung.urblatt.pk %}?from=geliefert">U</a>
                </td>
            {% else %}
                <td></td>
            {% endif %}
            <td></td>
            <td></td>
            <td>{{ x.k_fertigungsauftrag|default:"" }}</td>
            <td>{{ x.bezeichnung.materialnummer|default:"" }}</td>
            <td>{{ x.bezeichnung.bezeichnung|default:"" }}</td>
            <td></td>
            <td>{{ x.k_auftragsmenge }}</td>
            <td>{{ x.k_endtermin|date:"d.m.Y" }}</td>
            <td>{{ x.statuskomponente }}</td>
        </tr>
        {% endif %}
    {% endfor %}
{% endif %}
{% endfor %}

            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
